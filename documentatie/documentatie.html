<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentatie RUnDa</title>

    <link rel="stylesheet" href="https://w3c.github.io/scholarly-html/css/scholarly.min.css">
    <script src="js/scholarly.min.js"></script>
</head>

<body>

    <div role="content-info">
        <h1>Documentatie RUnDa</h1>
        <section typeof="sa:ProjectLinks">
            <ul>
                <li typeof="schema:WebPage" role="link" resource="https://github.com/Octavzz/RUnDa"
                    property="schema:citation" id="github">
                    <cite property="schema:name">
                        <a href="https://github.com/Octavzz/RUnDa">Github</a>
                    </cite>
                </li>
                <li typeof="schema:WebPage" role="link" resource="https://app.swaggerhub.com/apis/GaSM/GaSM/1.0.0#/"
                    property="schema:citation" id="github">
                    <cite property="schema:name">
                        <a href="https://app.swaggerhub.com/apis/GaSM/GaSM/1.0.0#/">Swagger</a>
                    </cite>
                </li>
            </ul>
        </section>

        <section typeof="sa:AuthorsList">
            <h2>Autori</h2>
            <ul>
                <li typeof="sa:ContributorRole" property="schema:author">
                    <span typeof="schema:Person">
                        <meta property="schema:givenName" content="Octavian">
                        <meta property="schema:familyName" content="Iacob">
                        <span property="schema:name">Iacob Octavian</span>
                    </span>
                    <ul>
                        <li property="schema:roleContactPoint" typeof="schema:ContactPoint">
                            <a href="emailOctav" property="schema:email">octav@gmail.com</a>
                        </li>

                    </ul>
                </li>
                <li typeof="sa:ContributorRole" property="schema:author">
                    <span typeof="schema:Person">
                        <meta property="schema:givenName" content="Stefan">
                        <meta property="schema:familyName" content="Ichim">
                        <span property="schema:name">Ichim Stefan</span>
                    </span>
                    <ul>
                        <li property="schema:roleContactPoint" typeof="schema:ContactPoint">
                            <a href="ichim.stefan99@gmail.com" property="schema:email">ichim.stefan99@gmail.com</a>
                        </li>

                    </ul>
                </li>
                <li typeof="sa:ContributorRole" property="schema:author">
                    <span typeof="schema:Person">
                        <meta property="schema:givenName" content="Andrei">
                        <meta property="schema:familyName" content="Prepelita">
                        <span property="schema:name">Prepelita Andrei</span>
                    </span>
                    <ul>
                        <li property="schema:roleContactPoint" typeof="schema:ContactPoint">
                            <a href="alexvasile99@yahoo.com" property="schema:email">andreiimagil@grkmr</a>
                        </li>

                    </ul>
                </li>
            </ul>
        </section>

        <h2>Cuprins</h2>
        <ol role="directory">
            <li>
                <a href="#despre-proiect">
                    <span> 1. </span>
                    Despre proiect
                </a>
            </li>
            <li>
                <a href="#front-end">
                    <span> 2. </span>
                    Front End
                </a>

                <ol role="directory">
                    <li>
                        <a href="#navbar">
                            <span> 2.0. </span>
                            Navbar
                        </a>
                    </li>
                    <li>
                        <a href="#first-page">
                            <span> 2.1. </span>
                            Pagina Principala
                        </a>
                    </li>
                    <li>
                        <a href="#map">
                            <span> 2.2. </span>
                            Harta Romaniei
                        </a>
                    </li>
                    <li>
                        <a href="#diagrams">
                            <span> 2.3. </span>
                            AJAX
                        </a>
                        <ol role="directory">
                            <li>
                                <a href="#filtrare">
                                    <span> 2.3.1 </span>
                                    Filtre
                                </a>
                            </li>
                            <li>
                                <a href="#generareDiagrame">
                                    <span> 2.3.2 </span>
                                    Generare Diagrame
                                </a>
                            </li>

                            <li>
                                <a href="#export">
                                    <span> 2.3.3 </span>
                                    Export
                                </a>
                            </li>
                        </ol>
                    </li>
                    <li>
                        <a href="#aboutPage">
                            <span> 2.4. </span>
                            Despre Proiect
                        </a>
                    </li>
                    <li>
                        <a href="#contact-page">
                            <span> 2.4. </span>
                            Pagina Contact
                        </a>
                    </li>
                </ol>
            </li>
            <li>
                <a href="#back-end">
                    <span> 3. </span>
                    Back End
                </a>

                <ol role="directory">
                    <li>
                        <a href="#map-creation">
                            <span> 3.1. </span>
                            Creare harta
                        </a>
                    </li>
                    <li>
                        <a href="#generate-chart">
                            <span> 3.2. </span>
                            Generare Diagrame
                        </a>
                        <ol role="directory">
                            <li>
                                <a href="#pieChart">
                                    <span> 3.2.1 </span>
                                    Pie Chart
                                </a>
                            </li>
                            <li>
                                <a href="#lineChart">
                                    <span> 3.2.2 </span>
                                    Line Chart
                                </a>
                            </li>
                            <li>
                                <a href="#barChart">
                                    <span> 3.2.3 </span>
                                    Bar Chart
                                </a>
                            </li>
                        </ol>
                    </li>
                    <li>
                        <a href="#export">
                            <span> 3.3. </span>
                            Export
                        </a>
                        <ol role="directory">
                            <li>
                                <a href="#exportCSV">
                                    <span> 3.3.1 </span>
                                    CSV
                                </a>
                            </li>
                            <li>
                                <a href="#exportSVG">
                                    <span> 3.3.2 </span>
                                    SVG
                                </a>
                            </li>
                            <li>
                                <a href="#exportPDF">
                                    <span> 3.3.3 </span>
                                    PDF
                                </a>
                            </li>
                            <li>
                                <a href="#exportXML">
                                    <span> 3.3.4 </span>
                                    XML
                                </a>
                            </li>
                        </ol>
                    </li>

                    <li>
                        <a href="#admin-panel">
                            <span> 3.4. </span>
                            Panou Administrator
                        </a>
                    </li>

                    <li>
                        <a href="#hartafront">
                            <span> 3.4. </span>
                            Harta
                        </a>
                    </li>

                </ol>
            </li>
            <li>
                <a href="#database">
                    <span> 4. </span>
                    Baza de date
                </a>

                <ol role="directory">
                    <li>
                        <a href="#judete">
                            <span> 4.1.</span>
                             Judete Romania
                        </a>
                    </li>

            </li>
            <li>
                <a href="educatie">
                    <span> 4.2. </span>
                     Educatie
                </a>
            </li>
            <li>
                <a href="#varste">
                    <span> 4.3. </span>
                     Varste
                </a>
            </li>
            <li>
                <a href="#medii">
                    <span> 4.4. </span>
                     Medii
                </a>
            </li>
            <li>
                <a href="#rata">
                    <span> 4.4. </span>
                     Rata
                </a>
            </li>
            <li>
                <a href="#fisiere">
                    <span> 4.4. </span>
                     Fisiere
                </a>
            </li>
            <li>
                <a href="#admin">
                    <span> 4.4. </span>
                     Admin
                </a>
            </li>
            <li>
                <a href="#contact">
                    <span> 4.4. </span>
                    Contact
                </a>
            </li>
        </ol>
        </li>
        </ol>
    </div>

    <section id="despre-proiect">

        <h2>
            Despre Proiect
        </h2>

    </section>

    <section id="front-end">

        <h2>
            Front End
        </h2>
        <p>Partea de front end ofera un design simplu dar eficient. Are elemente de baza pentru o experienta placuta a
            utilizatorului
            Acest site poate fi folosit atat pe un laptop/calculator, cat si pe un device mai mic avand
            functionalitatea de responsive.</p>
        <section id="navbar">
            <h3>
                Navbar
            </h3>
            <p>
                In partea stanga se afla numele proiectului avand forma normala pe o dimensiune care permite acest
                lucru,
                iar acronimul atunci cand este pe o dimensiune mai mica.
                <br>
                In partea dreapta se afla 3 pictograme, una trimitand la repository al proiecutlui(pe Github),
                una care trimite catre pagina about.html, iar ultima care trimite catre contact.php
            </p>
        </section>
        <section id="first-page">
            <h3>
                Pagina Principala
            </h3>
            <p>In aceasta pagina se afla un buton Start Now prin care se acceseaza pagina 'map.html',
                pagina in care se regaseste harta Romaniei
            </p>
        </section>
        <section id="map">
            <h3> Harta Romaniei</h3>
            <p>
                In aceasta pagina gasim harta Romaniei care a fost creata folosita biblioteca D3 js.

            </p>
        </section>
        <section id="filtrare">
            <h3> Filtre</h3>
            <p> Odata ajuns aici, userul are 3 selectii de facut.
                Prima oara trebuie sa selecteze tabela din care vrea sa vada datele. In acest moment stiu numele tabelei
                si pot sa il adaug la un URL dinamic pentru urmatorii pasi. In functie de ce tabel a selectat clientul,
                ii va aparea o noua filtrare care va cuprinde
                doar coloanele care sunt specifice acelui tabel
            </p>
            <p> A doua selectie se refera la anul din care utilizatorul vrea sa vada datele. Optiunile sunt 2019,
                respectiv 2020</p>
            <p> Ultima optiune este pe baza primei optinui, iar in functie de tabela selectata apar coloanele care se
                gasesc in tabela respectiva</p>
            <p> Dupa ce toate selectiile au fost facute, se folosi API pentru a trece la pasul urmator. Acesta arata
                ceva de genul asta:
                http://localhost/RunDa/api/counties/cluj?filtered_by=educatie&year=2020

            <figure typeof="sa:image">
                <img src="../images/documentatie/dataFilters.png">
                <figcaption>Fig. 1 Bar Chart pe un judet</figcaption>
            </figure>
            </p>
        </section>
        <section id="generareDiagrame">
            <h2> Generare Diagrame</h2>
            <p>Dupa ce toate criteriile de selectie sunt facute, se va selecta tipul de diagrama dorit.</p>
            <p> Pentru acest lucru, avem la dispozitie 3 tipuri de diagrame, iar fiecare dintre acestea a fost realziata
                folosind biblioteca D3 JS </p>
            <figure typeof="sa:image">
                <img src="../images/documentatie/typeCharts.png">
                <figcaption>Fig. 1 Tipurile de diagrame</figcaption>
            </figure>
            <li>Line Chart</li>
            <p>In aceasta diagrama se afla pe axa OY informatiile despre coloana care a fost selectata dintr-un anumit
                tabel,
                iar pe axa OX se afla lunile din anul selectat.</p>
            <p>De asemenea, aceasta diagrama a fost realizata folosind si un design responsive pentru dispozitive cu
                rezolutie mica. De la o anumita rezolutie,
                pentru a nu strica calitatea imaginii se aplica un scroll orizontal, prin care utilziatorul poate vedea
                clar informatiile respective.
            </p>
            <figure typeof="sa:image">
                <img src="../images/documentatie/lineChart1.png">
                <figcaption>Fig. 1 Line Chart pe un singur judet</figcaption>
            </figure>


            <li>Bar Chart</li>
            <p> Pe axa OY se afla informatiile despre fiecare luna din anul selectat, iar pe axa OX se afla informatiile
                despre o coloana aleasa din tabelul selectata
            </p>
            <p> Totodata, este aplicat si aici design-ul responsive, avand acelasi rol ca si la diagrama Line Chart</p>
            <figure typeof="sa:image">
                <img src="../images/documentatie/barChart1.png">
                <figcaption>Fig. 1 Bar Chart pe un judet</figcaption>
            </figure>
            <li>Pie Chart</li>
        </section>
        <section id="export">
            <h2> Export</h2>
            <p>In momentul in care avem si diagrama afisata, utilizatorul are optiunea de a face export
                intr-un anumit format(CSV,SVG,PDF,XML). Exportul are 2 optiuni, in functie de cate judete au fost
                selectate:
                daca s-a selectat un judet atunci va fi exportat doar acesta, daca s-au selectat 2 judete, atunci
                vor fi exportate cele 2.
            </p>
            <figure typeof="sa:image">
                <img src="../images/documentatie/exportBtns.png">
                <figcaption>Fig. 1 Butoanele de export</figcaption>
            </figure>
        </section>

        <section id="aboutPage">
            <h2>About Page</h2>
            <p> Aceasta pagina a fost creata cu rolul de a oferi informatii despre ce poate afla utilizand acest
                proiect.
                Contine mai multe paragrafe, insotite de o imagine ilustrativa.
            </p>
        </section>
        <section id="contact-page">
            <h2> Contact page</h2>
            <p>despre contact, de scris!</p>
        </section>
    </section>
    <!--front end-->
    <section id="back-end">
        <h2> Back End</h2>
        <section id="map-creation">
            <h3> Creare Harta</h3>

        </section>
        <section id="generate-chart">
            <h3> Generare Diagrame</h3>
            <p>
                Diagramele au fost concepute folosind bilioteca D3 js. Am ales aceasta biblioteca deoarece
                am considerat ca este interesant cum se creaza de la 0 o diagrama.
                Pentru fiecare diagrama creata, am facut o cerere prin care sa sa iau datele din baza de date,
                folsindu-ma de API REST.
                Datele au fost parsate printr-un json si in acest mod am putut afisa informatiile in mod dinamic cerute
                de catre utilizator.
            </p>

            <section id="pieChart">
                <h3> Pie Chart</h3>
                <p> despre pic</p>
            </section>
            <section id="lineChart">
                <h3> Line Chart</h3>
                <p> Pe axa Ox se afla lunile, iar pe axa OY se afla informatiile din coloana selctata.
                    <br>
                    Pe verticala scalez cu functia
                    scaleLiniar deoarece doresc sa porneasca de la valoarea cea mai mica si sa se termine cu valoare cea
                    mai mare din intervalul care contine informatiile despre coloana.
                    <br>Pe orizontala scalez cu functia scaleBand deoarece am nevoie sa-mi scaleze in functie de o
                    anumita categorie, iar in cazul meu este luna.
                <p>
                    Mai jos urmeaza o bucatica de cod din
                    functia lineChart()
                    , functie care genereaza diagrama.

                <figure typeof="schema:SoftwareSourceCode">
                    <pre>
                        const yAxisG = g.append('g').call(yAxis);
                        yAxisG.selectAll('.domain').remove()
                          .attr('transform', `translate(500,${margin.top})`);
                  
                        yAxisG.append('text')
                          .attr('class', 'axis-label')
                          .attr('y', -60)
                          .attr('x', -innerHeight / 2)
                          .style('fill', '#8E8883')
                          .style('font-size', '2.5em')
                          .attr('transform', `rotate(-90)`)
                          .attr('text-anchor', 'middle')
                          .text(yAxisLabel.replace('_', ' ').replace('_', ' '));
                  
                        const xAxisG = g.append('g').call(xAxis)
                          .attr('transform', `translate(0,${innerHeight})`);
                  
                        xAxisG.select('.domain').remove();
                  
                        xAxisG.append('text')
                          .attr('class', 'axis-label')
                          .attr('y', 80)
                          .attr('x', innerWidth / 2)
                          .attr('fill', 'black')
                          .text(xAxisLabel.replace('_', ' ').replace('_', ' '));
                  
                        const lineGenerator = line()
                          .x(d => xScale(xValue(d)))
                          .y(d => yScale(yValue(d)))
                          .curve(curveBasis)
                  
                  
                        g.append('path')
                          .attr('class', 'line-path')
                          .attr('d', lineGenerator(data))
                          //styles pentru cum sa arate linia
                          .style('fill', "none")
                          .style('stroke', "#137B80")
                          .style('stroke-width', '4')
                          .style('stroke-linejoin', 'round')
                          .style('stroke-linecap', 'round')
                  
                  
                        g.append('text')
                          .attr('class', 'title')
                          .attr('y', -10)
                          .style('font-size', '2em')
                          .style('font-family', 'sans-serif')
                  
                          .text(title);
                    </pre>
                </figure>

            </section>
            <section id="barChart">
                <h3> Bar Chart</h3>
                <p> La aceasta diagrama, pe axa OX se afla informatiile dintr-un tabel, iar pe axa OX se afla lunie.
                    In aceasta diagrama voi folosi un obiect de tip rectangle care imi creaza barele propriu zise.
                    <br>
                    Procedeul este
                    invers
                    fata de lineChart, in sensul ca scaleLiniar devine scaleBand si invers, totodata pastrandu-si
                    proprietatile.

                </p>

                <figure typeof="schema:SoftwareSourceCode">
                    <pre>
                        let xAxis = axisBottom(xScale)
                        .tickFormat(xAxisTickFormat)
                        .tickSize(-innerHeight);
                
                      g.append('g')//g.append('g) este selectia
                        .call(axisLeft(yScale))
                        .selectAll('.domain, .tick line')
                        .remove();
                
                      let xAxisG = g.append('g').call(xAxis)
                        .attr('transform', `translate(0,${innerHeight})`);//ca sa cifrele din populatie jos
                
                      xAxisG.select('.domain').remove();
                
                      xAxisG.append('text')
                        .attr('class', 'axis-label')
                        .attr('y', 65)
                        .attr('x', innerWidth / 2)
                        .attr('fill', 'black')
                        .text(xAxisLabelText.replace('_', ' ').replace('_', ' '))
                
                
                
                      g.selectAll('rect').data(data)
                        .enter().append('rect')
                        .attr('y', d => yScale(yValue(d)))
                        .attr('width', d => xScale(xValue(d)))
                        .attr('height', yScale.bandwidth())
                        .style('fill','#137B80')
                      
                
                      g.append('text')
                        .style("fill", "grey")
                        .attr('class', 'title')
                        .attr('y', -10)
                        .text(titleText)
                
                
                   
                    </pre>
                </figure>

            </section>
        </section>
        <section id="export">
            <h3> Export</h3>
      
        <section id="exportCSV">
            <h3> Export CSV</h3>
            <p> Pentru a putea exporta in format CSV, am folosit 3 functii care ma ajut sa fac acest lucru
                Prima functie este pentru a transforma obiectele JSON in CSV, introducand virgula, specifica acestui tip
                de format.

            </p>
            <figure typeof="schema:SoftwareSourceCode">
                <pre>
                    const objectToCsv = function(data) {
                        //get the  HEADERS
                        const csvRows = [] //array pt ca o sa am multe randuri tip csv
                        const headers = Object.keys(data[0]); //aici iau cheia obiectului(si primul element din data)
                        csvRows.push(headers.join(',')) //prima oara pun headers, separate de virgula(ca-i csv)
                
                        //loop over the rows
                        for (const row of data) { //parcurg fiecare rand 
                            const values = headers.map(header => { //add the data to object
                                const escaped = ('' + row[header]).replace(/"/g, '\\"') //din number il fac string
                                    //pun ghilimele ca sa evit ca un element din csv-ul meu sa aiba el o virgula care nu apartine de csv
                                return `"${escaped}"`
                            })
                            csvRows.push(values.join(',')) // pun virgula intre valorile de pe un rand
                        }
                        //form csv
                
                        return csvRows.join('\n')
                    };
                
                </pre>
            </figure>
            <p> O alta metoda este cea prin care folosesc functia fetch cu care iau json-ul, iar apoi mapez datele
                astfel incat
                sa iau doar datele pe care utilizatorul le vrea </p>
            <figure typeof="schema:SoftwareSourceCode">
                <pre>
                        const getReport = async function() {

                            console.log("urlForCsv = " + urlForCsv)
                            const res = await fetch(urlForCsv) //fetch- metoda browserului de a lua data.  fetch returneaza o promisiune
                            const json = await res.json() //cu aceasta linie pot lua si datele, nu doar headers....
                            console.log(json)
                    
                            console.log(getColumn);
                            const data = json.map(row => ({ //mapez ca sa imi puna in csv doar ce vreau, nu tot
                                month: row.month,
                                year: row.year,
                                [getColumn]: row[getColumn]
                    
                    
                            }));
                            const csvData = objectToCsv(data) //apelez functia de mai sus
                            download(csvData)
                    
                            console.log("DATA:");
                            console.log(data);
                    
                        }
                    </pre>
            </figure>
            <p> O alta functie folosita este aceea prin care descarc fisierul propriu zis, folosind blob.</p>
            <figure typeof="schema:SoftwareSourceCode">
                <pre>
                    const download = function(data) {
                        const blob = new Blob([data], { type: 'text/csv' }) //cu blob pot downloada
                        const url = window.URL.createObjectURL(blob); //trimit blob catre browser.imi da posiibilitatea sa fac un url dintr-un object(csv)
                        const a = document.createElement('a'); //a tag pt click
                        a.setAttribute('hidden', '')
                        a.setAttribute('href', url) //unde sa trimit 
                        a.setAttribute('download', `${getTableName}_${getCountyName}_${getYear}.csv`)
                        document.body.appendChild(a) //inainte sa dau click
                        a.click();
                        document.body.removeChild(a) //dupa ce dau click
                    }
                
                </pre>
            </figure>
        </section>
        <section id="exportSVG">
            <h3> Export SVG</h3>
            <p> export svg bla bla</p>
        </section>
        <section id="exportPDF">
            <h3> Export PDF</h3>
            <p> export PDFfffffffffffffff</p>
        </section>
        <section id="exportSVG">
            <h3> Export XML</h3>
            <p> export XMLEEEE</p>
        </section>
    </section>   <!--export-->

        <section id="admin-panel">
            <h3> Admin Panel</h3>
            <p>Panoul de administrare ofera posibilitatea de a incarca noi fisiere CSV in baza de date si se pot vizualiza mesajele
                primite de la utilizatori.</p>
                <p> Pentru a putea accesa panul de administrator este nevoie de autentificare printr-un username si o parola.
                    Se face o metoda de tip POST prin care se introduc datele necesare pentru atuentificare. Se folosesc parametrii dinamici pentru a preveni SQL injection.
                    De asemenea, parola este in format hash pentru o securitate mai buna.
                    <br>
                    Daca username si parola au fost introduse corect, atunci administratorul este trimis pe pagina 'login_success.php', pagina in care poate incarca fisiere si poate
                    vizualiza date. 
                </p>
                <figure typeof="schema:SoftwareSourceCode">
                    <pre>
                        try {
                            if (isset($_POST["login"])) {
                                if (empty($_POST["username"]) || empty($_POST["password"])) {
                                    $message = '<label>All fields are required</label>';
                                } else {
                                    $query = "SELECT password FROM users WHERE username = :username ";
                                    $statement = $connectDB->getPDO()->prepare($query);
                                    $statement->execute(
                                        array(
                                            'username'     =>     $_POST["username"]
                                        )
                                    );
                                    $count = $statement->rowCount();
                                    if ($count > 0) {
                                        $result = $statement->fetch(PDO::FETCH_ASSOC);
                                        if (password_verify($_POST['password'], $result['password'])) {
                        
                                            $_SESSION["username"] = $_POST["username"];
                                            header("location:login_success.php");  //aici tre sa vad
                                        } else {
                                            $message = '<label>Wrong Data</label>';
                                        }
                                    } else {
                                        $message = '<label>Wrong Data</label>';
                                    }
                                }
                            }
                    </pre>
                </figure>
           <p> odata ajuns pe</p>
            <figure typeof="schema:SoftwareSourceCode">
                <pre>
                    session_start();
    if (!function_exists('mysqli_result')) {
        function mysqli_result($res, $row, $field = 0)
        {
            $res->data_seek($row);
            $datarow = $res->fetch_array();
            return $datarow[$field];
        }
    }
    $connect = mysqli_connect("localhost", "root", "", "nivel_somaj");
    if (isset($_SESSION["username"])) {
        if (isset($_POST["submit"])) {
            if ($_FILES['file']['name']) {
                $value = $_FILES['file']['name'];
                $query = "SELECT count(*)  from fisiere
                WHERE filename = '$value'    ";
                $result = mysqli_query($connect, $query);
                if (mysqli_result($result, 0) === '0') {
                    echo mysqli_result($result, 0);

                    $query = " INSERT INTO fisiere (filename) VALUES ('$value')";
                    mysqli_query($connect, $query);
                    ...........
                </pre>
            </figure>
        </section>

    </section>
    <!--back end-->

</body>

</html>